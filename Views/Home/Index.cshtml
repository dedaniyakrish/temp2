@{
    ViewData["Title"] = "Dashboard";
}

<div class="page-header text-center">
    <div class="container">
        <h1 class="page-title">Hospital Management Dashboard</h1>
        <p class="page-subtitle">Welcome back! Here's what's happening at your hospital today.</p>
    </div>
</div>

<div class="row g-4 mb-5 animate-stagger">
    <!-- Patients Card -->
    <div class="col-xl-2 col-md-4 col-6">
        <div class="card stats-card card-patients text-center h-100">
            <div class="card-body d-flex flex-column align-items-center justify-content-center p-4">
                <div class="stats-icon icon-patients">
                    <i class="bi bi-people"></i>
                </div>
                <div class="stats-number">@ViewBag.PatientCount</div>
                <div class="stats-label">Patients</div>
                <div class="stats-sublabel">Total Registered</div>
                <a asp-controller="Patient" asp-action="PatientList" class="btn btn-primary btn-sm">
                    <i class="bi bi-eye me-1"></i>View Details
                </a>
            </div>
        </div>
    </div>
    
    <!-- Doctors Card -->
    <div class="col-xl-2 col-md-4 col-6">
        <div class="card stats-card card-doctors text-center h-100">
            <div class="card-body d-flex flex-column align-items-center justify-content-center p-4">
                <div class="stats-icon icon-doctors">
                    <i class="bi bi-person-badge"></i>
                </div>
                <div class="stats-number">@ViewBag.DoctorCount</div>
                <div class="stats-label">Doctors</div>
                <div class="stats-sublabel">Available Specialists</div>
                <a asp-controller="Doctor" asp-action="DoctorList" class="btn btn-success btn-sm">
                    <i class="bi bi-eye me-1"></i>View Details
                </a>
            </div>
        </div>
    </div>
    
    <!-- Appointments Card -->
    <div class="col-xl-2 col-md-4 col-6">
        <div class="card stats-card card-appointments text-center h-100">
            <div class="card-body d-flex flex-column align-items-center justify-content-center p-4">
                <div class="stats-icon icon-appointments">
                    <i class="bi bi-calendar-check"></i>
                </div>
                <div class="stats-number">@ViewBag.AppointmentCount</div>
                <div class="stats-label">Appointments</div>
                <div class="stats-sublabel">Total Scheduled</div>
                <a asp-controller="Appointment" asp-action="AppointmentList" class="btn btn-warning btn-sm">
                    <i class="bi bi-eye me-1"></i>View Details
                </a>
            </div>
        </div>
    </div>
    
    <!-- Departments Card -->
    <div class="col-xl-2 col-md-4 col-6">
        <div class="card stats-card card-departments text-center h-100">
            <div class="card-body d-flex flex-column align-items-center justify-content-center p-4">
                <div class="stats-icon icon-departments" style="background: linear-gradient(135deg, #10b981, #059669);">
                    <i class="bi bi-building"></i>
                </div>
                <div class="stats-number">@ViewBag.DepartmentCount</div>
                <div class="stats-label">Departments</div>
                <div class="stats-sublabel">Medical Specialties</div>
                <a asp-controller="Department" asp-action="DepartmentList" class="btn btn-success btn-sm">
                    <i class="bi bi-eye me-1"></i>View Details
                </a>
            </div>
        </div>
    </div>
    
    <!-- Users Card -->
    <div class="col-xl-2 col-md-4 col-6">
        <div class="card stats-card card-users text-center h-100">
            <div class="card-body d-flex flex-column align-items-center justify-content-center p-4">
                <div class="stats-icon icon-users" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
                    <i class="bi bi-person"></i>
                </div>
                <div class="stats-number">@ViewBag.UserCount</div>
                <div class="stats-label">Users</div>
                <div class="stats-sublabel">System Access</div>
                <a asp-controller="User" asp-action="UserList" class="btn btn-secondary btn-sm">
                    <i class="bi bi-eye me-1"></i>View Details
                </a>
            </div>
        </div>
    </div>
    
    <!-- Doctor-Departments Card -->
    <div class="col-xl-2 col-md-4 col-6">
        <div class="card stats-card card-relations text-center h-100">
            <div class="card-body d-flex flex-column align-items-center justify-content-center p-4">
                <div class="stats-icon icon-relations" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                    <i class="bi bi-diagram-3"></i>
                </div>
                <div class="stats-number">@ViewBag.DoctorDepartmentCount</div>
                <div class="stats-label">Relations</div>
                <div class="stats-sublabel">Doctor-Department</div>
                <a asp-controller="DoctorDepartment" asp-action="DoctorDepartmentList" class="btn btn-warning btn-sm">
                    <i class="bi bi-eye me-1"></i>View Details
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Appointments per Department Chart -->
<div class="row mb-5">
    <div class="col-12">
        <div class="card">
            <div class="page-header">
                <div class="container">
                <h3 class="page-title" style="font-size: 1.5rem;">
                    <i class="bi bi-bar-chart-fill me-2"></i>
                    Appointments per Department
                </h3>
                </div>
            </div>
            <div class="card-body p-4">
                <canvas id="appointmentsChart" height="100"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Today's Appointments & Recent Activity -->
<div class="row">
    <!-- Today's Appointments -->
    <div class="col-lg-6 mb-4">
        <div class="card h-100">
            <div class="page-header" style="background: linear-gradient(135deg, var(--warning-600) 0%, var(--warning-500) 100%);">
                <div class="container">
                <h4 class="page-title" style="font-size: 1.25rem;">
                    <i class="bi bi-calendar-event me-2"></i>
                    Today's Appointments
                </h4>
                </div>
            </div>
            <div class="card-body p-4">
                <div class="table-responsive">
                    <table class="table table-modern">
                        <thead>
                            <tr>
                                <th><i class="bi bi-person me-1"></i>Patient</th>
                                <th><i class="bi bi-person-badge me-1"></i>Doctor</th>
                                <th><i class="bi bi-clock me-1"></i>Time</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (ViewBag.TodaysAppointments != null)
                            {
                                foreach (var appt in ViewBag.TodaysAppointments)
                                {
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="icon-wrapper me-2" style="width: 35px; height: 35px; background: linear-gradient(135deg, var(--primary-500), var(--primary-400));">
                                                    <i class="bi bi-person text-white"></i>
                                                </div>
                                                <span class="fw-semibold">@appt.PatientName</span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="icon-wrapper me-2" style="width: 35px; height: 35px; background: linear-gradient(135deg, var(--success-500), var(--success-400));">
                                                    <i class="bi bi-person-badge text-white"></i>
                                                </div>
                                                <span class="fw-semibold">@appt.DoctorName</span>
                                            </div>
                                        </td>
                                        <td>
                                            <span class="status-badge" style="background-color: var(--primary-100); color: var(--primary-700);">
                                                <i class="bi bi-clock me-1"></i>@appt.Time
                                            </span>
                                        </td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr>
                                    <td colspan="3" class="text-center py-5">
                                        <div class="empty-state">
                                            <i class="bi bi-calendar-x fs-1 d-block mb-3"></i>
                                            <h5>No appointments scheduled for today</h5>
                                            <p class="mb-0">Check back later or schedule new appointments.</p>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="col-lg-6 mb-4">
        <div class="card h-100">
            <div class="page-header" style="background: linear-gradient(135deg, var(--secondary-700) 0%, var(--secondary-600) 100%);">
                <div class="container">
                <h4 class="page-title" style="font-size: 1.25rem;">
                    <i class="bi bi-activity me-2"></i>
                    Recent Activity
                </h4>
                </div>
            </div>
            <div class="card-body p-4">
                <div class="activity-timeline">
                    @if (ViewBag.RecentActivity != null)
                    {
                        foreach (var activity in ViewBag.RecentActivity)
                        {
                            <div class="activity-item d-flex align-items-center">
                                <div class="icon-wrapper me-3" style="width: 40px; height: 40px; background: linear-gradient(135deg, var(--primary-100), var(--primary-50));">
                                    <i class="bi bi-clock text-primary"></i>
                                </div>
                                <div class="activity-content">
                                    <p class="mb-1 fw-semibold">@activity</p>
                                    <small class="text-muted">Recent activity</small>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="empty-state">
                                <i class="bi bi-clock-history fs-1 d-block mb-3"></i>
                                <h5>No recent activity</h5>
                                <p class="mb-0">Activity will appear here as actions are performed.</p>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        @using System.Text.Json
        const chartLabels = @Html.Raw(JsonSerializer.Serialize(ViewBag.ChartLabels ?? new string[0]));
        const chartData = @Html.Raw(JsonSerializer.Serialize(ViewBag.ChartData ?? new int[0]));
        const ctx = document.getElementById('appointmentsChart').getContext('2d');
        const appointmentsChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: chartLabels,
                datasets: [{
                    label: 'Appointments',
                    data: chartData,
                    backgroundColor: [
                        '#4e73df',
                        '#1cc88a',
                        '#36b9cc',
                        '#f6c23e',
                        '#e74a3b',
                        '#6f42c1',
                        '#20c997',
                        '#fd7e14',
                        '#0dcaf0',
                        '#adb5bd'
                    ],
                    borderRadius: 10
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    </script>
}
